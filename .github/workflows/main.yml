steps:
- name: 检出代码
  uses: actions/checkout@v4

- name: 设置 Python
  uses: actions/setup-python@v5
  with:
    python-version: "3.10"

- name: 安装 Buildozer 和依赖
  run: |
    python -m pip install --upgrade pip
    pip install buildozer

- name: 安装 Cython（关键！）
  run: |
    pip install "cython==0.29.36"

- name: 安装系统依赖
  run: |
    sudo dpkg --add-architecture i386
    sudo apt-get update
    sudo apt-get install -y git zip unzip openjdk-17-jdk
    sudo update-alternatives --set java /usr/lib/jvm/java-17-openjdk-amd64/bin/java

- name: 构建 APK
  run: |
    buildozer -v android debug

- name: 上传 APK
  uses: actions/upload-artifact@v4
  with:
    name: inspection-tool-apk
    path: bin/*.apk
